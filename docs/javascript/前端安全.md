## XSS 攻击

XSS(Cross-Site Scripting，跨站脚本攻击)是一种代码注入攻击。攻击者在目标网站上注入恶意代码，当被攻击者登陆网站时就会执行这些恶意代码，这些脚本可以读取 cookie，session tokens，或者其它敏感的网站信息，对用户进行钓鱼欺诈，甚至发起蠕虫攻击等

#### 反射型 XSS

> 当用户点击一个恶意链接，或者提交一个表单，或者进入一个恶意网站时，注入脚本进入被攻击者的网站。Web 服务器将注入脚本，比如一个错误信息，搜索结果等，未进行过滤直接返回到用户的浏览器上。

攻击步骤：

- 1、攻击者构造出特殊的 URL，其中包含恶意代码。
- 2、用户打开带有恶意代码的 URL 时，网站服务端将恶意代码从 URL 中取出，拼接在 HTML 中返回给浏览器。
- 3、用户浏览器接收到响应后解析执行，混在其中的恶意代码也被执行。
- 4、恶意代码窃取用户数据并发送到攻击者的网站，或者冒充用户的行为，调用目标网站接口执行攻击者指定的操作。

防范：**使用`encodeURIComponent`对参数对字符串进行编码，转义后再输出**

#### DOM 型 XSS

> DOM 型 XSS 攻击，实际上就是前端 JavaScript 代码不够严谨，把不可信的内容插入到了页面。在使用 .innerHTML、.outerHTML、.appendChild、document.write()等 API 时要特别小心，不要把不可信的数据作为 HTML 插到页面上，尽量使用 .innerText、.textContent、.setAttribute() 等

攻击步骤：

- 1、攻击者构造出特殊数据，其中包含恶意代码。
- 2、用户浏览器执行了恶意代码。
- 3、恶意代码窃取用户数据并发送到攻击者的网站，或者冒充用户的行为，调用目标网站接口执行攻击者指定的操作。

如在评论中输入恶意代码

```js
我是评论内容
<script>alert('我是恶意代码')</script>
```

防范：**对输入内容进行转义**

```js
function encodeHtml(str) {
  return str
    .replace(/"/g, "&quot;")
    .replace(/'/g, "&apos;")
    .replace(/</g, "&lt;")
    .replace(/>/g, "&gt;");
}
```

#### 存储型 XSS

> 恶意脚本永久存储在目标服务器上。当浏览器请求数据时，脚本从服务器传回并执行，影响范围比反射型和 DOM 型 XSS 更大

攻击步骤：

- 1、攻击者将恶意代码提交到目标网站的数据库中。
- 2、用户打开目标网站时，网站服务端将恶意代码从数据库取出，拼接在 HTML 中返回给浏览器。
- 3、用户浏览器接收到响应后解析执行，混在其中的恶意代码也被执行。
- 4、恶意代码窃取用户数据并发送到攻击者的网站，或者冒充用户的行为，调用目标网站接口执行攻击者指定的操作。

防范方式：

- 传递给服务器之前，先转义/过滤
- 服务器接收到数据，在存储到数据库之前，进行转义/过滤
- 前端接收到服务器传递过来的数据，在展示到页面前，先进行转义/过滤
- 使用 `HTTP` 头部`Content-Security-Policy: default-src 'self'`只加载同源文件
- 输入内容长度限制，对内容中特殊字符限制
- 设置 `Cookie:HttpOnly` 禁止客户端脚本访问 `Cookie`

## CSRF

> CSRF（Cross-site request forgery）跨站请求伪造：攻击者诱导受害者进入第三方网站，在第三方网站中，向被攻击网站发送跨站请求。利用受害者在被攻击网站已经获取的注册凭证，绕过后台的用户验证，达到冒充用户对被攻击的网站执行某项操作的目的。

攻击步骤：

- 1、受害者登录 A 站点，并保留了登录凭证（Cookie）。
- 2、攻击者诱导受害者访问了站点 B。
- 3、站点 B 向站点 A 发送了一个请求，浏览器会默认携带站点 A 的 Cookie 信息。
- 4、站点 A 接收到请求后，对请求进行验证，并确认是受害者的凭证，误以为是无辜的受害者发送的请求。
- 5、站点 A 以受害者的名义执行了站点 B 的请求。
- 6、攻击完成，攻击者在受害者不知情的情况下，冒充受害者完成了攻击。

防范方式：

- 使用 `Token` ：服务端给用户生成一个 token，加密后传递给用户,用户在提交请求时，需要携带这个 token,服务端验证 token 是否正确
- `Set-Cookie`: 标明这个 Cookie 是个“同站 Cookie”，方案未正式发布，存在兼容性

## 单击劫持

> 点击劫持是指在一个 Web 页面中隐藏了一个透明的`iframe`，用外层假页面诱导用户点击，实际上是在隐藏的 frame 上触发了点击事件进行一些用户不知情的操作。

攻击步骤：

- 1、攻击者构建了一个非常有吸引力的网页【不知道哪些内容对你们来说有吸引力，我就不写页面了，偷个懒】
- 2、将被攻击的页面放置在当前页面的 `iframe` 中
- 3、使用样式将 `iframe` 叠加到非常有吸引力内容的上方
- 4、将`iframe`设置为 100%透明
- 5、你被诱导点击了网页内容，你以为你点击的是\*\*\*，而实际上，你成功被攻击了。

防范方式：

```js
if (top.location != window.location) {
  top.location = window.location;
}
```

设置 `HTTP` 头 `X-Frame-Options:DENY` ：拒绝任何域加载

## 安全扫描工具

[Arachni](https://github.com/Arachni/arachni)：Arachni 是基于 Ruby 的开源，功能全面，高性能的漏洞扫描框架

[Mozilla HTTP Observatory](https://github.com/mozilla/http-observatory/)：Mozilla 发布的一款名为 Observatory 的网站安全分析工具

[w3af](https://github.com/andresriancho/w3af)：基于 Python 的 Web 应用安全扫描器
